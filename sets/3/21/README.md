# Challenge 21

**Implement the MT19937 Mersenne Twister RNG**

## Challenge Description

> You can get the pseudocode for this from Wikipedia.
> 
> If you're writing in Python, Ruby, or (gah) PHP, your language is probably already giving you MT19937 as "rand()"; don't use rand(). Write the RNG yourself.

## Solution

I followed the pseudocode from Wikipedia pretty closely.

## Properties of MT19937

I will use the space here to outline some properties of MT19937 that will be relevant in later challenges.

An MT19937 PRNG is initialized with an unsigned 32-bit "**seed**". It then generates an infinite sequence of 32-bit numbers. Two PRNGs initialized with the same seed will generate the same sequence.

### Period

Eventually, the sequence will repeat itself; the length of the repeating sequence is called the "period." For MT19937, the period is $2^{19937} - 1$, which is very, **very** large. For illustration, if we computed the next element in the sequence every **nanosecond**, it would take $1.4 \cdot 10^{5985}$ **years** for the sequence to repeat.

### Recurrence relation 

The sequence $x_0, x_1, x_2, \ldots$ generated by MT19937 is modelled as a **recurrence relation** of degree $n$. A recurrence relation is function that computes the value of $x_i$ based on the previous values in the sequence. The recurrence having "degree $n$" means that the oldest value that $x_i$ depends on is $x_{i-n}$. Thus, an implementation of MT19937 only needs to remember the past $n$ outputs to compute the next output; these $n$ values are called the **state** of the PRNG. In MT19937, we have $n = 624$. For efficiency, the state can be implemented as a circular buffer for $O(1)$ insertion each time `rand()` is called. Even though we must maintain the past $n$ values, the recurrence for $x_i$ actually only uses three of these values, so `rand()` is $O(1)$ with respect to $n$.

### Tempering

When calling `rand()`, MT19937 does not return $x_i$ to the user directly. Instead, it first applies a **tempering transform** $T$ to $x_i$ to get a new value $z_i := x_i T$. I believe the purpose of this function is to essentially "spread" the bits of the number more, but its true purpose gets into a bunch of very deep theory that I definitely do not understand. Notably, the tempering transform is _invertible_. Also, the state is composed of the original _untempered_ values $x_{i-n+1}, \ldots, x_i$, rather than the tempered values returned to the user.

### Initialization

The state of the MT19937 is initialized to $x_0, \ldots, x_{n-1}$, calculated deterministically based on the seed. The first time `rand()` is called, the PRNG computes $x_n$, rather than $x_0$, and returns $x_n T$.
